events {}
http {
    # Add these to ensure proper handling of JSON, etc.
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # Add logging for troubleshooting
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    upstream hardware_api {
        server hardware-api:8080;
    }
    upstream organization_api {
        server organization-api:8080;
    }
    upstream resource_api {
        server resource-api:8080;
    }
    server {
        listen 8080;
        
        # Add this to handle root requests
        location / {
            return 200 'Gateway is running';
        }
        
        location /hardware/ {
            proxy_pass http://hardware_api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            rewrite ^/hardware(/.*)$ $1 break;
        }
        
        location /org/ {
            proxy_pass http://organization_api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            rewrite ^/org(/.*)$ $1 break;
        }
        
        location /api/ordering {
            proxy_pass http://resource_api/api/ordering;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            # No rewrite needed if we want to keep the /user/ prefix
        }

        location /api/ {
            proxy_pass http://organization_api/api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            # No rewrite needed if we want to keep the /user/ prefix
        }
    }
}
